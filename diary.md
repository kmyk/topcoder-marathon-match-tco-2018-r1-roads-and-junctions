## 日記

### 問題概要

2次元平面上に NC 個の町がある。
町と町の間に線分で道を敷設しすべての町を連結にしたい。
ただし道の敷設には長さに比例した費用がかかる。
道の端点は町か交差点である必要がある。
道の敷設の前に一度だけ、好きな数の交差点を建設してよい。
交差点の建設(の試行)には費用を支払う必要があり、ある確率で建設に失敗する。
できるだけ少ない費用を使ってすべての町を連結にせよ。

制約:

-   空間の幅 100 \le S \le 1000
-   町の数 10 \le NC \le 100
-   交差点の費用 0.0 \le junctionCost \le 10.0
-   交差点の建設の失敗の確率 0% \le failureProbability \le 40%

得点:

-   raw score: (道の総距離) + junctionCost * (交差点の数)
-   交差点の数には建設に失敗したものも含む
-   overall score: raw score が他の参加者より小さいと得点

### 5/10

今回は何すればいいか分からない。
焼き鈍しもビームサーチも効きにくそうでつらい。
chokudaiさんが1位取りそう。

下手に交差点の建設をさぼると連結化不可能になって詰むし難しいなあというのが第一印象だったが、visualizeしたら斜めの道もありだった。
道の交差の有無などは陽に確認したのに、道は軸平行だと思い込んでいた。
だって町の座標が整数点だったんだもん。
まだ数分考えただけとはいえ、誤読の情報だけ学習して他はちゃんと0から考察をrestartしないと前回と同じ轍を踏むぞ。

とりあえず交差点なしだと最小全域木やるだけ。
交差点ありだと(建設の成功失敗が決定した後でさえ)ちょっと面倒。
石鹸膜の表面積最小化みたいなあれが必要。
交差点ありの場合は最小Steiner木問題と呼ばれNP困難らしい (出典: [Steiner tree problem - Wikipedia](https://en.wikipedia.org/wiki/Steiner_tree_problem), [シュタイナー木 - Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%A5%E3%82%BF%E3%82%A4%E3%83%8A%E3%83%BC%E6%9C%A8))。
でも今回は前回と違ってちゃんと平面グラフなので多項式解法あるかも。
そういえば師匠がICPC用としてSteiner木ライブラリ持ってたなあ。
交差点の位置が固定された後ですらNP困難なのに建設の試行からやるのつらいなあ。
Dreyfus-Wagner法というのがあるぽい (参考: [Spaghetti Source - 最小シュタイナー木 (Dreyfus-Wagner)](http://www.prefield.com/algorithm/dp/steiner_tree.html), [指数時間アルゴリズム入門, 岩田陽一 - SlideShare](https://www.slideshare.net/wata_orz/ss-12131479)) が、ほとんどの頂点が端点になる場合には実質ただの全探索になりそう。
Molle-Richter-Rossmanith法というのもあるらしいが方向性は変わらず。
すごく近いのがWikipediaにそのまま乗ってた: [Euclidean Steiner tree](https://en.wikipedia.org/wiki/Steiner_tree_problem#Euclidean_Steiner_tree)。

無駄なもの建設してもしかたがないので建設したものについては全部使うと仮定したい。
これは罠で、ふたつそろえば超効果的だけどひとつだけだとむしろ邪魔、みたいな場合が反例。
いやそんな例は実際に発生するのだろうか。
ひとつ削除して試してみて良くなれば候補として採用し、候補からふたつ選んで削除して...と繰り返すのはどうか。
複数削除して良くなるならその部分を削除しても良くなるという形の単調性が仮定されている。
これも反例ありそうだが。

最小全域木の手法はたくさんあるので調べるとKruskal法やPrim法より適したものがありそう。
特に今回は Euclidean complete graph なのでいくらでもどうにかできそう。

とりあえず交差点はひとつだけ建設するとすると評価関数 : N^2 -> R の最小化で、いい感じに微分とかして連続最適化っぽくしたい。
最終的にできた全域木を見てグラフ描画における力学モデルの要領でずらしてやればいいのかな。
なんだかk-means法っぽくなるね。
となると交差点の数 NJ は最初に固定してしまうのがいいのかも。


とりあえず Prim法。
交差点なしで基準点としてまず最小全域木。
密なので Kruskal法 より良いかなと思ったけど実際分からん。 両方試すべき。
基準点ということでそのまま提出した。
撤退の是非を議論するのは手損になるため。
この点数より低い人々は何をしてるんだろう。 単に退路を断つだけなら同じでしょという意見もある。
そして kurenai3110 さんが1位。 twitterの表示名でハラスメントするのやめてください。

<details>
<summary>順位表 2018年  5月 10日 木曜日 18:54:20 JST</summary>

| Handle        | Score      | Rank  | Last Submission Time     | Language  | Example Tests  | Submissions  |
|---------------|------------|-------|--------------------------|-----------|----------------|--------------|
| kurenai3110   | 875740.74  | 1     | 05.10.2018 03:46:19 EST  | C++       | 1              | 1            |
| gorbunov      | 871851.85  | 2     | 05.10.2018 05:41:08 EST  | C++       | 2              | 2            |
| nika          | 847037.04  | 3     | 05.10.2018 05:05:56 EST  | C++       | 0              | 2            |
| windhunterSB  | 798333.33  | 4     | 05.10.2018 05:15:40 EST  | C++       | 2              | 2            |
| kishore_g84   | 761851.85  | 5     | 05.10.2018 00:16:14 EST  | Java      | 1              | 1            |
| yowa          | 735740.74  | 6     | 05.09.2018 22:35:20 EST  | C++       | 1              | 1            |
| assy0000      | 705185.19  | 7     | 05.10.2018 04:33:05 EST  | C++       | 3              | 2            |
| sidekick      | 691111.11  | 8     | 05.10.2018 02:20:17 EST  | Java      | 0              | 1            |
| Daiver19      | 675925.93  | 9     | 05.10.2018 01:14:47 EST  | C++       | 1              | 1            |
| keymoon       | 675925.93  | 9     | 05.10.2018 01:43:56 EST  | C#        | 1              | 1            |
| Lozy          | 675925.93  | 9     | 05.10.2018 01:21:36 EST  | C++       | 1              | 1            |
| shamal        | 661851.85  | 12    | 05.10.2018 04:45:23 EST  | C++       | 1              | 1            |
| fluffyowl     | 655000.00  | 13    | 05.10.2018 02:21:10 EST  | C++       | 2              | 1            |
| bduvenhage    | 653703.70  | 14    | 05.10.2018 04:00:25 EST  | C++       | 1              | 1            |
| kimiyuki      | 653703.70  | 14    | 05.10.2018 05:53:10 EST  | C++       | 1              | 1            |
| Masa-Y        | 653703.70  | 14    | 05.10.2018 01:21:28 EST  | C++       | 1              | 1            |
| mcw1142       | 653703.70  | 14    | 05.10.2018 02:01:26 EST  | Java      | 1              | 1            |
| scott_wu      | 653703.70  | 14    | 05.09.2018 21:28:01 EST  | C++       | 1              | 1            |
| senya0126     | 493888.89  | 19    | 05.10.2018 03:24:33 EST  | C++       | 1              | 1            |
| vlad_D        | 489444.44  | 20    | 05.10.2018 01:33:59 EST  | C++       | 2              | 1            |
| NEU20133823   | 272222.22  | 21    | 05.10.2018 02:09:49 EST  | C++       | 2              | 2            |
| daisyo        | 222222.22  | 22    | 05.10.2018 03:25:33 EST  | C++       | 2              | 2            |
| CatalinT      | 175185.19  | 23    | 05.10.2018 03:34:11 EST  | C++       | 1              | 1            |
| NobuMiu       | 116666.67  | 24    | 05.09.2018 21:20:25 EST  | C++       | 1              | 1            |
| mugurelionut  | 108148.15  | 25    | 05.10.2018 05:13:49 EST  | C++       | 1              | 1            |
| masakt        | 100740.74  | 26    | 05.10.2018 05:52:34 EST  | C++       | 1              | 1            |
| babybuffalo   | 14074.07   | 27    | 05.09.2018 22:06:27 EST  | C++       | 1              | 1            |
| moshu         | 14074.07   | 27    | 05.10.2018 01:55:55 EST  | C++       | 1              | 1            |
| cheaps        | -          | -     | -                        | -         | 1              | 0            |
| sas4eka       | -          | -     | -                        | -         | 2              | 0            |
| shin_taku     | -          | -     | -                        | -         | 1              | 0            |

</details>


<https://twitter.com/koyumeishi_/status/994540145436123137> たしかに二分されてて面白い。

<details>
<summary>順位表 2018年  5月 10日 木曜日 20:34:57 JST</summary>

| Handle        | Score      | Rank  | Last Submission Time     | Language  | Example Tests  | Submissions  |
|---------------|------------|-------|--------------------------|-----------|----------------|--------------|
| yowa          | 867567.57  | 1     | 05.10.2018 06:33:31 EST  | C++       | 2              | 2            |
| gorbunov      | 847567.57  | 2     | 05.10.2018 05:41:08 EST  | C++       | 2              | 2            |
| kurenai3110   | 847432.43  | 3     | 05.10.2018 03:46:19 EST  | C++       | 1              | 1            |
| nika          | 820405.41  | 4     | 05.10.2018 05:05:56 EST  | C++       | 0              | 2            |
| windhunterSB  | 765270.27  | 5     | 05.10.2018 05:15:40 EST  | C++       | 2              | 2            |
| Kriii         | 764054.05  | 6     | 05.10.2018 06:03:40 EST  | C++       | 0              | 1            |
| kishore_g84   | 745405.41  | 7     | 05.10.2018 00:16:14 EST  | Java      | 1              | 1            |
| assy0000      | 672972.97  | 8     | 05.10.2018 06:39:09 EST  | C++       | 4              | 3            |
| skrzypl1      | 669729.73  | 9     | 05.10.2018 06:47:48 EST  | C#        | 1              | 1            |
| sidekick      | 667567.57  | 10    | 05.10.2018 02:20:17 EST  | Java      | 0              | 1            |
| fetetriste    | 658783.78  | 11    | 05.10.2018 07:07:30 EST  | Java      | 1              | 1            |
| daisyo        | 642702.70  | 12    | 05.10.2018 07:26:20 EST  | C++       | 3              | 3            |
| Daiver19      | 642702.70  | 12    | 05.10.2018 01:14:47 EST  | C++       | 1              | 1            |
| Jeffrey.Ho    | 642702.70  | 12    | 05.10.2018 06:41:56 EST  | C++       | 1              | 1            |
| keymoon       | 642702.70  | 12    | 05.10.2018 01:43:56 EST  | C#        | 1              | 1            |
| Lozy          | 642702.70  | 12    | 05.10.2018 01:21:36 EST  | C++       | 1              | 1            |
| m_dz          | 642702.70  | 12    | 05.10.2018 07:04:41 EST  | C++       | 1              | 1            |
| shamal        | 634594.59  | 18    | 05.10.2018 04:45:23 EST  | C++       | 1              | 1            |
| fluffyowl     | 626756.76  | 19    | 05.10.2018 02:21:10 EST  | C++       | 2              | 1            |
| bduvenhage    | 625405.41  | 20    | 05.10.2018 04:00:25 EST  | C++       | 1              | 1            |
| fal_rnd       | 625405.41  | 20    | 05.10.2018 06:39:42 EST  | Java      | 1              | 1            |
| kimiyuki      | 625405.41  | 20    | 05.10.2018 05:53:10 EST  | C++       | 1              | 1            |
| Masa-Y        | 625405.41  | 20    | 05.10.2018 01:21:28 EST  | C++       | 1              | 1            |
| mcw1142       | 625405.41  | 20    | 05.10.2018 02:01:26 EST  | Java      | 1              | 1            |
| mugurelionut  | 625405.41  | 20    | 05.10.2018 07:20:55 EST  | C++       | 2              | 2            |
| sas4eka       | 625405.41  | 20    | 05.10.2018 05:54:04 EST  | C++       | 2              | 1            |
| scott_wu      | 625405.41  | 20    | 05.09.2018 21:28:01 EST  | C++       | 1              | 1            |
| senya0126     | 445405.41  | 28    | 05.10.2018 03:24:33 EST  | C++       | 1              | 1            |
| vlad_D        | 443783.78  | 29    | 05.10.2018 01:33:59 EST  | C++       | 2              | 1            |
| kt_tenel      | 430945.95  | 30    | 05.10.2018 06:22:44 EST  | C++       | 1              | 1            |
| NEU20133823   | 203243.24  | 31    | 05.10.2018 02:09:49 EST  | C++       | 2              | 2            |
| my316g        | 158918.92  | 32    | 05.10.2018 07:29:27 EST  | C++       | 2              | 1            |
| CatalinT      | 129729.73  | 33    | 05.10.2018 03:34:11 EST  | C++       | 1              | 1            |
| ceni1055      | 87837.84   | 34    | 05.10.2018 07:24:01 EST  | C++       | 1              | 1            |
| masakt        | 70000.00   | 35    | 05.10.2018 05:52:34 EST  | C++       | 1              | 1            |
| NobuMiu       | 68648.65   | 36    | 05.09.2018 21:20:25 EST  | C++       | 1              | 1            |
| babybuffalo   | 12162.16   | 37    | 05.09.2018 22:06:27 EST  | C++       | 1              | 1            |
| moshu         | 12162.16   | 37    | 05.10.2018 01:55:55 EST  | C++       | 1              | 1            |
| cheaps        | -          | -     | -                        | -         | 1              | 0            |
| shin_taku     | -          | -     | -                        | -         | 2              | 0            |

</details>


ある点に交差点を置いた場合の点数の差分を可視化した。
とても楽しい。
3Dもしたがあまり役には立たず。
基本は三角形の重心あたりが最適となるぽい。
隣接する三角形による改善同士は干渉しそうだが、そうでない限りはかなりそれぞれ局所的に解けそう。
愚直に三角形を総当たりしてもよいが、時間もいくらかあるしDelaunay三角形分割とかをしたい気もする。
乱択でわりと簡単らしい (出典: [ドロネー三角形分割, shiatsumat - SlideShare](https://www.slideshare.net/Kinokkory/ss-25736696)) しまだ書いたことないのでやりたい。

-   ![1.png](https://raw.githubusercontent.com/kmyk/topcoder-marathon-match-tco-2018-r1-roads-and-junctions/documents/images/1.png?token=ACGd-LRp7RBarKRCwgXHweC6Ohr9eqJnks5a_YPxwA%3D%3D)
-   ![2.png](https://raw.githubusercontent.com/kmyk/topcoder-marathon-match-tco-2018-r1-roads-and-junctions/documents/images/2.png?token=ACGd-KsY1jXnMMVqqDRhBeQWVNu5jVoZks5a_YTwwA%3D%3D)
-   ![3.png](https://raw.githubusercontent.com/kmyk/topcoder-marathon-match-tco-2018-r1-roads-and-junctions/documents/images/3.png?token=ACGd-GuGYaZ02Kn62-9IbtnFqvJ7Zp3Nks5a_YTiwA%3D%3D)
-   ![2.3d.png](https://raw.githubusercontent.com/kmyk/topcoder-marathon-match-tco-2018-r1-roads-and-junctions/documents/images/2.3d.png?token=ACGd-E2xhjyMxU9Riv-omjdmCp3IXmSpks5a_YT7wA%3D%3D)
